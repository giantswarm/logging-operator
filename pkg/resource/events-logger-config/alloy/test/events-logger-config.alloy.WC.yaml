# This file was generated by logging-operator.
# It configures Alloy to be used as events logger.
# - configMap is generated from events-logger.alloy.template and passed as a string
#   here and will be created by Alloy's chart.
# - Alloy runs as a deployment, with only 1 replica.
alloy:
  alloy:
    configMap:
      create: true
      content: |-
        loki.source.kubernetes_events "local" {
        	namespaces = ["kube-system", "giantswarm"]
        	forward_to = [loki.write.default.receiver]
        }
        
        // Loki target configuration
        loki.write "default" {
        	endpoint {
        		url                = env("LOKI_URL")
        		max_backoff_period = "10m"
        		tenant_id          = env("TENANT_ID")
        
        		basic_auth {
        			username = env("BASIC_AUTH_USERNAME")
        			password = env("BASIC_AUTH_PASSWORD")
        		}
        
        		tls_config {
        			insecure_skip_verify = false
        		}
        	}
        	external_labels = {
        		cluster_id   = "test-cluster",
        		installation = "test-installation",
        		scrape_job = "kubernetes-events",
        	}
        }
        
        logging {
        	level  = "info"
        	format = "logfmt"
        }
        
    envFrom:
    - secretRef:
        name: alloy-events
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: false
      runAsUser: 10
      runAsGroup: 10
      runAsNonRoot: true
      seccompProfile:
        type: RuntimeDefault
  controller:
    type: deployment
    replicas: 1
  crds:
    create: false
